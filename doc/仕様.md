# 仕様
- [SIP関連RFC和訳 | 技術ライブラリ | テクノロジー | SOFTFRONT](http://www.softfront.co.jp/technology-library-rfc/)
  - [RFC 3261 - SIP(セッション開始プロトコル)](http://www.softfront.co.jp/tech/ietfdoc/trans/rfc3261j.txt)
  - [RFC 3261 - SIP: Session Initiation Protocol](https://tools.ietf.org/html/rfc3261)
- [Digest認証 - Wikipedia](https://ja.wikipedia.org/wiki/Digest%E8%AA%8D%E8%A8%BC)
  - [RFC 7616 - HTTP Digest Access Authentication](https://tools.ietf.org/html/rfc7616)

# RFC 3261 - SIP(セッション開始プロトコル)
## 10 登録
- 10.1 概要
  - [ ] ~~あるドメインのための登録サーバーはロケーションサービスへのデータを読み書きできなければならず[MUST]、~~
    - クライアントでは考慮しない。
  - [ ] ~~そのドメインのためのプロキシまたはリダイレクトサーバーはそのデータを読むことができなければならない[MUST]ということである。~~
    - クライアントでは考慮しない。
  - [ ] ~~登録サーバーは、同じドメインのための特定のSIPプロキシサーバーと同じ場所に配置してもよい[MAY]。~~
    - クライアントでは考慮しない。
- 10.2 REGISTERリクエストの構築
  - [ ] UACはREGISTERリクエストに、セクション8.1で述べられている既存のルートセットに基づくRouteヘッダーフィールドを含めてもよい[MAY]。
  - [ ] Record-RouteヘッダーフィールドはREGISTERリクエストまたは応答において何ら意味を持たず、存在した場合には無視されなければならない[MUST]。
  - [ ] 特に、UACはREGISTERリクエストに対するいかなる応答中のRecord-Routeヘッダーフィールドの存在/不在に基づいても、新しいルートセットを生成してはならない[MUST NOT]。
  - [ ] 以下のヘッダーフィールドは、Contactを除いて、REGISTERリクエストに含めなければならない[MUST]。Contactヘッダーフィールドは含めてもよい[MAY]。
    - [ ] Request-URI: Request-URIは、登録が行われるロケーションサービスのドメインを示す(例: sip:chicago.com)。SIP URIのuserinfoと@コンポーネントが存在してはならない[MUST NOT]。
    - [ ] To: Toヘッダーフィールドは、登録が生成、問い合わせ、あるいは修正されるAdress-of-Recordを含む。ToヘッダーフィールドとRequest-URIフィールドは、前者がユーザーネームを含むので通常は異なる。このAddress-of-RecordはSIP URIまたはSIPS URIでなければならない[MUST]。
    - [ ] From: Fromヘッダーフィールドは、登録を行う人のAddress-of-Recordを含む。リクエストがサードパーティによる登録でなければ、この値はToヘッダーフィールドと同じである。
    - [ ] Call-ID: UACからのすべての登録は、特定の登録サーバーに送られる登録に対して、同じCall-IDヘッダーフィールド値を使用するべきである[SHOULD]。同一のクライアントが異なるCall-ID値を使用した場合、登録サーバーは、遅延したREGISTERリクエストが順番が狂って到着したのか、あるいはそうでないのか検知できない。
      - 初回登録時に、1度だけCall-IDを生成する。
    - [ ] CSeq: CSeq値はREGISTERリクエストの適切な並び順を保証する。UAは、同じCall-IDを持つ各REGISTERリクエストに対してCSeq値を1ずつインクリメントしなければならない[MUST]。
    - [ ] Contact: REGISTERリクエストは、アドレスバインディングを含むゼロ個以上の値を持つContactヘッダーフィールドを含めてもよい[MAY]。
      - Contactヘッダーフィールドを付加する。
  - [ ] UAは、登録サーバーから以前に送った登録への最終応答を受け取るか、以前のREGISTERリクエストがタイムアウトするまで、新たな登録(すなわち、再送とは違い新しいContactヘッダーフィールド値を含む)を送ってはならない[MUST NOT]。
    - (TODO)
  - [x] 以下のContactヘッダーパラメータはREGISTERリクエストにおいて特別な意味を持つ。
    - [x] action: ~~RFC2543からのactionパラメータは反対されている。UACはactionパラメータを使用するべきではない[SHOULD NOT]。~~
      - actionパラメータは使用しない。
    - [x] expires: ~~expiresパラメータは、どれだけの期間バインディングが有効であってほしいとUAが望むかを示す。値は秒を表す数字である。~~このパラメータが提供されない場合、Expiresヘッダーフィールドの値が代わりに使用される。~~実装では、2* *32-1(4294967295秒または136年)よりも大きい値を2**32-1と等しい値として扱ってもよい[MAY]。おかしな値は3600と等しい値として扱うべきである[SHOULD]。~~
      - Expiresヘッダフィールドを付加する。expiresパラメータは付加しない。
  - 10.2.1 バインディングの追加
    - [ ] 登録サーバーに送られたREGISTERリクエストはAddress-of-Recordに対するSIPリクエストが転送(forward)されるべき[SHOULD]コンタクトアドレス(一つまたは複数)を含む。Address-of-Recordは、REGISTERリクエストのToヘッダーフィールドに含まれる。
      - Contactヘッダフィールドを付加する。
    - [ ] リクエストのContactヘッダーフィールド値は一般的に特定のSIPエンドポイントを特定するSIP URIまたはSIPS URIからなるが、どのようなURIスキームでも使用してもよい[MAY]。
      - SIP URIとする。
    - [ ] クライアントがいったん登録サーバーでバインディングを確立すると、それは必要に応じて、既存のバインディングに対する新しいバインディングまたは修正を含む登録を送ってもよい[MAY]。
      - 更新機能を実装する。
    - [x] REGISTERリクエストのToヘッダーフィールドのAddress-of-RecordがSIPS URIの場合、そのリクエストのすべてのContactヘッダーフィールド値もSIPS URIであるべきである[SHOULD]。
      - SIPS URIをサポートしない。
    - 10.2.1.1 Contactアドレスの有効期限間隔の設定
    - 10.2.1.2 Contactアドレス間のプリファレンス
  - 10.2.2 バインディングの削除
  - 10.2.3 バインディングの取得
  - 10.2.4 バインディングのリフレッシュ
  - 10.2.5 内部クロックの設定
  - 10.2.6 登録サーバーの発見
  - 10.2.7 リクエストの送信
  - 10.2.8 エラー応答
- 10.3 REGISTERリクエスト処理
  - 原則、クライアントでは考慮しない。一部、補足に抽出する。
- 補足
  - [ ] 登録サーバーは423(IntervalToo Brief)応答で登録を拒否する可能性がある。[Page 64]
